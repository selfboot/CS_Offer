Linux中文件的权限有r(读) w(写) x(执行)，分别用数字4，2，1代表。创建文件时，默认权限666，目录的权限为777（对于目录来说，x意味着可以查看目录内容）。

Umask是设置系统创建文件时的默认权限，umask是从权限中“拿走”相应的位。

# 文件系统实现

## 共享文件

文件共享使多个用户（进程）共享同一份文件，系统中只需保留该文件的一份副本。如果系统不能提供共享功能，那么每个需要该文件的用户都要有各自的副本，会造成对存储空间的极大浪费。为解决文件的共享使用，Linux 系统引入了两种链接：硬链接 (hard link) 与软链接（又称符号链接，即 soft link 或 symbolic link）。

### 硬链接

在树形结构的目录中，当有两个或多个用户要共享一个子目录或文件时，必须将共享文件或子目录链接到两个或多个用户的目录中，才能方便地找到该文件，如下图所示。

![][1]

在这种共享方式中，诸如文件的物理地址及其他的文件属性等信息，不再是放在目录项中，而是放在索引结点中；在文件目录中只设置文件名及指向相应索引结点的指针。在索引结点中还应有一个链接计数count，用于表示链接到本索引结点（亦即文件）上的用户目录项的数目。当count=2时，表示有两个用户目录项链接到本文件上，或者说是有两个用户共享此文件。

当用户A创建一个新文件时，它便是该文件的所有者，此时将count置为1。当有用户B要共享此文件时，在用户B的目录中增加一个目录项，并设置一指针指向该文件的索引结点。此时，文件主仍然是用户A，count=2。如果用户A不再需要此文件，不能将文件直接删除。因为，若删除了该文件，也必然删除了该文件的索引结点，这样便会便用户B的指针悬空，而用户B则可能正在此文件上执行写操作，此时用户B会无法访问到文件。因此用户A不能删除此文件，只是将该文件的count减1，然后删除自己目录中的相应目录项。用户B仍可以使用该文件。当Count=0时，表示没有用户使用该文件，系统将负责删除该文件。下图给出了用户B链接到文件上的前、后情况。

![][2]

由于硬链接是有着相同 inode 号仅文件名不同的文件，因此硬链接存在以下几点特性：

1. 文件有相同的 inode 及 data block；
2. 只能对已存在的文件进行创建；
3. 不能交叉文件系统进行硬链接的创建；
4. 不能对目录进行创建，只可对文件创建；
5. 删除一个硬链接文件并不影响其他有相同 inode 号的文件。

硬链接可由命令 link 或 ln 创建，`ln source_file target_file`，如下例子：

    $ ln demo.o link_demo.o
    $ ls -li demo.o link_demo.o
    35104097 -rwxr-xr-x  2 feizhao  staff  15476 Apr 15 19:15 demo.o
    35104097 -rwxr-xr-x  2 feizhao  staff  15476 Apr 15 19:15 link_demo.o

### 软链接

此外，可以由系统创建一个 LINK 类型的新文件，并将 LINK 文件写入用户B的目录中，以实现用户B的目录与文件的链接。在新文件中只包含被链接文件的路径名，这样的链接方法被称为符号链接。（软连接是建立了一个iNode，专门用来指向实际文件的iNode，有点像Win下的快捷方式）。

在利用符号链方式实现文件共享时，只有文件的拥有者才拥有指向其索引结点的指针。而共享该文件的其他用户则只有该文件的路径名，并不拥有指向其索引结点的指针。这样，也就不会发生在文件主删除一共享文件后留下一悬空指针的情况。当文件的拥有者把一个共享文件删除后，其他用户通过符号链去访问它时，会出现访问失败，于是将符号链删除，此时不会产生任何影响。

在符号链的共享方式中，当其他用户读共享文件时，需要根据文件路径名逐个地查找目录，直至找到该文件的索引结点。因此，每次访问时，都可能要多次地读盘，使得访问文件的开销。此外，符号链的索引结点也要耗费一定的磁盘空间。但是符号链方式有一个很大的优点，即网络共享只需提供该文件所在机器的网络地址以及该机器中的文件路径即可。

软链接与硬链接不同，若文件用户数据块中存放的内容是另一文件的路径名的指向，则该文件就是软连接。软链接就是一个普通文件，只是数据块内容有点特殊。软链接有着自己的 inode 号以及用户数据块，因此软链接的创建与使用没有类似硬链接的诸多限制：

* 软链接有自己的文件属性及权限等；
* 可对不存在的文件或目录创建软链接，但直到这个名字对应的文件被创建后，才能打开其链接。
* 软链接有自己的inode，并在磁盘上有一小片空间存放路径名。因此，软链接能够跨文件系统，也可以和目录链接！
* 创建软链接时，链接计数 i_nlink 不会增加；
* 删除软链接并不影响被指向的文件，但若被指向的原文件被删除，则相关软连接被称为死链接（即 dangling link，若被指向路径文件被重新创建，死链接可恢复为正常的软链接）。

软链接可以用 ln -s 选项创建，`ln -s source_file target_file`，如下例子：

    $ ln -s demo.o softlink
    $ ls -li demo.o softlink
    35104097 -rwxr-xr-x  1 feizhao  staff  15476 Apr 15 19:15 demo.o
    35392402 lrwxr-xr-x  1 feizhao  staff      6 Apr 27 11:39 softlink -> demo.o

上述两种链接方式都存在一个共同的问题，有链接的文件中，文件有两个或者多个路径。查找一指定目录的全部文件的程序将多次定位到被连接的文件。那么一个将某一目录及其子目录下的全部文件转储到磁带上的程序有可能多次复制一个被链接的文件。

［[硬链接和软连接解读](http://www.nowcoder.com/questionTerminal/1b695f9055ed4017a9fe578ef8b02c34)］

参考  
[理解 Linux 的硬链接与软链接](https://www.ibm.com/developerworks/cn/linux/l-cn-hardandsymb-links/)  
[共享文件：硬链接和软链接](http://c.biancheng.net/cpp/html/2622.html)  

## 硬盘存取

硬盘的存取访问时间分为三个部分：寻道时间Ts，旋转延迟时间Tr和传送时间Tt。



[1]: http://7xrlu9.com1.z0.glb.clouddn.com/Linux_OS_FileSystem_1.jpg
[2]: http://7xrlu9.com1.z0.glb.clouddn.com/Linux_OS_FileSystem_2.jpg

